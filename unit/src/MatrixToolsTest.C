/****************************************************************/
/*               DO NOT MODIFY THIS HEADER                      */
/* MOOSE - Multiphysics Object Oriented Simulation Environment  */
/*                                                              */
/*           (c) 2010 Battelle Energy Alliance, LLC             */
/*                   ALL RIGHTS RESERVED                        */
/*                                                              */
/*          Prepared by Battelle Energy Alliance, LLC           */
/*            Under Contract No. DE-AC07-05ID14517              */
/*            With the U. S. Department of Energy               */
/*                                                              */
/*            See COPYRIGHT for full restrictions               */
/****************************************************************/
#include "MatrixToolsTest.h"

CPPUNIT_TEST_SUITE_REGISTRATION(MatrixToolsTest);

MatrixToolsTest::MatrixToolsTest() {}

void
MatrixToolsTest::matrixInversionTest1()
{
  // The matrix
  // ( 2  2)
  // (0.5 1)
  // has inverse
  // ( 1  -2)
  // (-0.5 2)
  std::vector<PetscScalar> mat2(2 * 2);
  std::vector<std::vector<Real>> m(2);
  for (auto & row : m)
    row.resize(2);

  mat2[0] = m[0][0] = 2.0;
  mat2[1] = m[0][1] = 2.0;
  mat2[2] = m[1][0] = 0.5;
  mat2[3] = m[1][1] = 1.0;

  MatrixTools::inverse(mat2, 2);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(1, mat2[0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-2, mat2[1], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-0.5, mat2[2], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(2, mat2[3], 1E-5);

  MatrixTools::inverse(m, m);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(1, m[0][0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-2, m[0][1], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-0.5, m[1][0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(2, m[1][1], 1E-5);
}

void
MatrixToolsTest::matrixInversionTest2()
{
  // The matrix
  // (1 2 3)
  // (4 5 6)
  // (7 8 1)
  // is singular
  std::vector<PetscScalar> mat3(3 * 3);
  std::vector<std::vector<Real>> m(3);
  for (auto & row : m)
    row.resize(3);

  mat3[0] = m[0][0] = 1.0;
  mat3[1] = m[0][1] = 2.0;
  mat3[2] = m[0][2] = 3.0;
  mat3[3] = m[1][0] = 4.0;
  mat3[4] = m[1][1] = 5.0;
  mat3[5] = m[1][2] = 6.0;
  mat3[6] = m[2][0] = 7.0;
  mat3[7] = m[2][1] = 8.0;
  mat3[8] = m[2][2] = 9.0;

  CPPUNIT_ASSERT_THROW(MatrixTools::inverse(mat3, 3), MooseException);
  CPPUNIT_ASSERT_THROW(MatrixTools::inverse(m, m), MooseException);

  std::vector<std::vector<Real>> m2(2);
  for (auto & row : m)
    row.resize(3);

  CPPUNIT_ASSERT_THROW(MatrixTools::inverse(m, m2), MooseException);

  std::vector<std::vector<Real>> m3(0);
  CPPUNIT_ASSERT_THROW(MatrixTools::inverse(m3, m3), MooseException);
}

void
MatrixToolsTest::matrixInversionTest3()
{
  // The matrix
  // (1 2 3)
  // (0 1 4)
  // (5 6 0)
  // has inverse
  // (-24 18  5)
  // (20 -15 -4)
  // (-5  4   1)
  std::vector<PetscScalar> mat3(3 * 3);
  std::vector<std::vector<Real>> m(3);
  for (auto & row : m)
    row.resize(3);

  mat3[0] = m[0][0] = 1.0;
  mat3[1] = m[0][1] = 2.0;
  mat3[2] = m[0][2] = 3.0;
  mat3[3] = m[1][0] = 0.0;
  mat3[4] = m[1][1] = 1.0;
  mat3[5] = m[1][2] = 4.0;
  mat3[6] = m[2][0] = 5.0;
  mat3[7] = m[2][1] = 6.0;
  mat3[8] = m[2][2] = 0.0;

  MatrixTools::inverse(mat3, 3);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-24, mat3[0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(18, mat3[1], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(5, mat3[2], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(20, mat3[3], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-15, mat3[4], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-4, mat3[5], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-5, mat3[6], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(4, mat3[7], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(1, mat3[8], 1E-5);

  MatrixTools::inverse(m, m);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-24, m[0][0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(18, m[0][1], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(5, m[0][2], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(20, m[1][0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-15, m[1][1], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-4, m[1][2], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(-5, m[2][0], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(4, m[2][1], 1E-5);
  CPPUNIT_ASSERT_DOUBLES_EQUAL(1, m[2][2], 1E-5);
}
